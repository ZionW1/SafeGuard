<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/base_layout}">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/css/style.css" />
    <style>
        /* 개별 카드 스타일은 이전처럼 유지 (필요에 따라 조정) */
        
        .card-image {
            margin: 0 12px;

            width: 90%;
            height:  300px; /* 고정 높이 */
            object-fit: fill; /* 이미지를 비율을 유지하면서 잘라내어 채움 */
        }
    
        .card-info {
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 5px; /* 내부 요소 간격 */
        }
    
    
        .card-badge.today { /* "오늘마감" 뱃지 색상 */
            background-color: #ffe0b2;
            color: #ef6c00;
        }
    
        .card-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
            margin: 0;
            line-height: 1.3;
            height: 2.6em; /* 두 줄까지 표시하고 넘치면 ... 처리 (선택 사항) */
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2; /* 2줄까지만 표시 */
            -webkit-box-orient: vertical;
        }

        .card-desc {
        font-size: 0.9em;
        color: #666;
        margin: 0;
        line-height: 1.4;
        height: 2.8em; /* 두 줄까지 표시 */
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        }
        .all_view_container{
            width: 90%;
            margin: 20px auto;
            display: flex;
            flex-wrap: wrap;
            gap: 16px; /* 카드 간의 가로세로 간격 */
            justify-content: flex-start;
        }

        .campaign_card {
            width: calc((100% - 16px * 4) / 5); /* 부모 너비에서 간격 빼고 5등분 */
            box-sizing: border-box;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }


        .card-badge {
            background-color: #e0f2f7; /* 기본 뱃지 색상 */
            color: #01579b;
            font-size: 0.8em;
            padding: 4px 8px;
            border-radius: 4px;
            align-self: flex-start; /* 뱃지를 왼쪽 정렬 */
            font-weight: bold;
        }
        
        
        .close-btn {
            font-size: 28px;
            font-weight: bold;
            float: right;
            cursor: pointer;
        }
       /* 지역 카테고리 컨테이너 */
.region-category {
    width: 100%;
    max-width: 900px; /* 전체 너비 제한 */
    background-color: #ffffff;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    overflow: hidden;
    padding: 30px;
}

/* 리스트 래퍼 (안쪽 여백) */
.region-list-wrapper {
    padding: 0; /* 필요에 따라 조정 */
}

/* 개별 지역 그룹 (예: 서울) */
.region-group {
    display: flex;
    flex-direction: column; /* 세로 방향으로 정렬 (제목 위에 서브 리스트) */
}

/* 메인 지역 타이틀 (예: 서울) 스타일 */
.region-main-title {
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #e0e0e0; /* 밑줄 추가 */
}

.region-main-title ul {
    list-style: none;
    margin: 0;
    padding: 0;
}

.region-main-title .title-text {
    font-size: 28px; /* 타이틀 글자 크기 */
    font-weight: bold;
    color: #343a40;
    padding: 0;
    margin: 0;
}

/* 서브 지역 리스트를 담는 그리드 컨테이너 */
.region-sub-list-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4개의 열로 균등하게 나눔 */
    gap: 20px 20px; /* 행과 열 사이의 간격 */
}

/* 각 서브 지역 리스트 (ul) */
.region-sub-list-grid ul {
    list-style: none;
    margin: 0;
    padding: 0;
}

/* 각 서브 지역 아이템 (li) */
.region-sub-list-grid li {
    font-size: 16px;
    color: #555555;
    padding: 8px 0;
    cursor: pointer;
    transition: color 0.2s ease, background-color 0.2s ease; /* 호버 효과 */
}

.region-sub-list-grid li:hover {
    color: #007bff; /* 호버 시 색상 변경 */
    /* background-color: #e9ecef; 배경색 변경도 고려할 수 있어 */
    font-weight: 600; /* 호버 시 글자 굵기 */
}

/* 반응형 디자인 (선택 사항이지만 좋은 연습!) */
@media (max-width: 768px) {
    .region-sub-list-grid {
        grid-template-columns: repeat(2, 1fr); /* 화면이 작아지면 2열로 */
    }
}

@media (max-width: 480px) {
    .region-sub-list-grid {
        grid-template-columns: 1fr; /* 더 작아지면 1열로 */
    }
    .region-category {
        padding: 20px;
    }
    .region-main-title .title-text {
        font-size: 24px;
    }
}
    </style>
    <script>
document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            document.querySelectorAll('.card-badge').forEach(function(badge) {
                console.log(badge.dataset)
                const dateStr = badge.dataset.appEndDateStr; // ${item.eventPeriodEnd != null ? #temporals.format(item.eventPeriodEnd, 'yyyy/MM/dd') : ''}
                console.log("dataStr : " + dateStr)
                if (!dateStr) {
                    badge.textContent = '기간 미정';
                    return;
                }
                const eventDate = new Date(dateStr.replace(/\./g, '/'));
                eventDate.setHours(0, 0, 0, 0);
            
                if (isNaN(eventDate.getTime())) {
                    badge.textContent = '날짜 오류';
                    return;
                }
            
                const diffDays = Math.ceil((eventDate - today) / (1000 * 60 * 60 * 24));
                if (diffDays === 0) {
                    badge.textContent = '오늘마감';
                    badge.classList.add('today');
                } else if (diffDays > 0) {
                    badge.textContent = `D-${diffDays}`;
                } else {
                    badge.textContent = '마감됨';
                }
            });

            // 예: option 값이 'recent', 'popular' 등
        
        });
    </script>
</head>
<body>
    <main layout:fragment="content">
        <!-- <form class="optionForm" action="/campaign08" method="get" id="form">
            <select id="orderCode" name="orderCode">
                <option th:value="0" th:selected="${option.orderCode==0}">최신 순</option>
                <option th:value="1" th:selected="${option.orderCode==1}">인기 순</option>
                <option th:value="2" th:selected="${option.orderCode==2}">선정확률 높은 순</option>
                <option th:value="3" th:selected="${option.orderCode==3}">마감임박 순</option>
    
            </select>
        </form> -->
        <form class="optionForm" action="/campaign08" method="get" id="form">
        </form>
        <div class="campaign-container">
            <th:block th:if="${!closedCampaign.isEmpty()}">
                <th:block th:each="campaign : ${closedCampaign}">
                    <div sec:authorize="!isAuthenticated()" class="guest-message">
                        <a th:href="|/campaign01?id=${campaign.campaignId}&userId=''|">
                            <div class="campaign-item">
        
                            <div class="campaign-card">
                                <img id="imgFile" th:src="|/img?id=${campaign.campaignId}|" alt="파일이미지" class="campaign-image"/>
                                <div class="campaign-info-box">
                                    <div class="campaign-tags">
                                        <span class="tag leader">
                                            <span th:text="|${campaign.userNm}|"></span>
                                            <span class="sub-text">인솔자</span>
                                        </span> 
                                        <span class="card-badge"
                                        th:data-app-end-date-str="${campaign.appPeriodEnd != null ? #temporals.format(campaign.appPeriodEnd, 'yyyy-MM-dd') : ''}"
                                        th:data-campaign-id="${campaign.campaignId}"></span>
                                    </div>
                                    <div class="title-overlay">
                                        <div class="card-title">
                                            <span class="campaign-title-text" th:text="${campaign.campaignTitle}"></span>
                                        </div>
                                    </div>
                                    
                                    <div class="campaign-stats">신청 <span th:text="${campaign.applicantsNum}"></span> / <span class="recruitment-num">모집 <span th:text="${campaign.recruitmentNum}"></span></span></div>
                                </div>
                            </div>
                            </div>
                        </a>
                    </div>
                    <div sec:authorize="isAuthenticated()" class="guest-message">
                        <a th:href="|/campaign01?id=${campaign.campaignId}&userId=${user.id}&eventPeriodStr=${campaign.eventPeriodStr}&eventPeriodEnd=${campaign.eventPeriodEnd}|">
                            <div class="campaign-card">
                                <img id="imgFile" th:src="|/img?id=${campaign.campaignId}|" alt="파일이미지" class="campaign-image"/>
                                <div class="campaign-info-box">
                                    <div class="campaign-tags">
                                        <span class="tag leader">
                                            <span th:text="|${campaign.userNm}|"></span>
                                            <span class="sub-text">인솔자</span>
                                        </span> 
                                        <span class="card-badge" th:data-app-end-date-str="${campaign.appPeriodEnd != null ? #temporals.format(campaign.appPeriodEnd, 'yyyy-MM-dd') : ''}" th:data-campaign-id="${campaign.campaignId}"></span>
                                    </div>
                                    <div class="title-overlay">
                                        <div class="card-title">
                                            <span class="campaign-title-text" th:text="${campaign.campaignTitle}"></span>
                                        </div>
                                    </div>
                                    
                                    <div class="campaign-stats">신청 <span th:text="${campaign.applicantsNum}"></span> / <span class="recruitment-num">모집 <span th:text="${campaign.recruitmentNum}"></span></span></div>
                                </div>
                            </div>
                        </a>
                    <!-- </div> -->
                </th:block>




                <!-- <div class="campaign-container">
                    <div class="campaign_card" th:each="item : ${closedCampaign}">
                        <img th:src="|/img?id=${item.campaignId}|" alt="캠페인 이미지" class="card-image"/>
                    
                        <div class="card-info">
                            <h3 class="card-title" th:text="${item.campaignTitle}">캠페인 제목</h3>
                            <div class="campaign-tags">
                                <span class="tag leader">
                                    <span th:text="|${item.userNm}|"></span>
                                    <span class="sub-text">인솔자</span>
                                </span> 
                                <span class="card-badge"
                                th:data-app-end-date-str="${item.appPeriodEnd != null ? #temporals.format(item.appPeriodEnd, 'yyyy-MM-dd') : ''}"
                                th:data-campaign-id="${item.campaignId}"></span>
                            </div>
                            <p class="card-desc">
                                모집: <span th:text="${item.applicantsNum}"></span>/<span th:text="${item.recruitmentNum}"></span>
                            </p>
                        </div>
                    </div>
                </div> -->
            </th:block>
            <th:block th:unless="${!closedCampaign.isEmpty()}">
                <div class="no-campaign-message">
                    <p>마감된 캠페인이 없습니다.</p>
                </div>
            </th:block>
        </div>
</body>
</html>